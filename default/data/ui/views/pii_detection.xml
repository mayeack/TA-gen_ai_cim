
<dashboard version="2" theme="dark">
    <label>PII Detection</label>
    <description>Machine learning-powered detection of Personally Identifiable Information (PII) in AI responses.</description>
    <definition><![CDATA[
{
    "title": "PII Detection",
    "description": "Machine learning-powered detection of Personally Identifiable Information (PII) in AI responses.",
    "inputs": {
        "input_model": {
            "dataSources": { "primary": "ds_model_filter" },
            "options": {
                "defaultValue": "*",
                "items": [{ "label": "All Models", "value": "*" }],
                "token": "model_filter"
            },
            "title": "Model ID",
            "type": "input.dropdown"
        },
        "input_service": {
            "dataSources": { "primary": "ds_service_filter" },
            "options": {
                "defaultValue": "*",
                "items": [{ "label": "All Apps", "value": "*" }],
                "token": "service_filter"
            },
            "title": "App Name",
            "type": "input.dropdown"
        },
        "input_time": {
            "options": { "defaultValue": "-24h@h,now", "token": "time" },
            "title": "Time Range",
            "type": "input.timerange"
        }
    },
    "defaults": {
        "dataSources": {
            "ds.search": {
                "options": {
                    "queryParameters": { "earliest": "-24h@h", "latest": "now" }
                }
            }
        }
    },
    "visualizations": {
        "viz_header_pii_ml": {
            "options": {
                "fontColor": "#ffffff",
                "markdown": "## ðŸ” PII ML Detection\n\nMachine learning-powered detection of Personally Identifiable Information (PII) in AI responses."
            },
            "type": "splunk.markdown"
        },
        "viz_pii_ml_by_service": {
            "dataSources": { "primary": "ds_pii_ml_by_service" },
            "options": { "count": 10 },
            "title": "PII Detections by Service",
            "type": "splunk.table"
        },
        "viz_pii_ml_category": {
            "dataSources": { "primary": "ds_pii_ml_category" },
            "options": {
                "seriesColors": ["#dc4e41", "#f8be34", "#6ab7c7", "#f1813f", "#a2cc3e", "#5cc05c", "#9b59b6", "#3498db"],
                "xAxisTitleText": "Count",
                "yAxisTitleText": "PII Category"
            },
            "title": "PII by Category",
            "type": "splunk.bar"
        },
        "viz_pii_ml_rate": {
            "dataSources": { "primary": "ds_pii_ml_rate" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "> majorValue | rangeValue(majorColorEditorConfig)",
                "majorColorEditorConfig": [
                    { "to": 5, "value": "#53a051" },
                    { "from": 5, "to": 15, "value": "#f8be34" },
                    { "from": 15, "value": "#dc4e41" }
                ],
                "sparklineDisplay": "off",
                "trendDisplay": "off",
                "unit": "%",
                "unitPosition": "after"
            },
            "title": "PII Detection Rate",
            "type": "splunk.singlevalue"
        },
        "viz_pii_ml_recent": {
            "context": {
                "Risk_LevelColumnFormatEditorConfig": {},
                "Risk_LevelRowBackgroundColorConfig": [
                    { "match": "CRITICAL", "value": "#9c1c1c" },
                    { "match": "HIGH", "value": "#DC4E41" },
                    { "match": "MEDIUM", "value": "#F8BE34" }
                ]
            },
            "dataSources": { "primary": "ds_pii_ml_recent" },
            "eventHandlers": [
                {
                    "options": {
                        "earliest": "$time.earliest$",
                        "latest": "$time.latest$",
                        "openInNewTab": true,
                        "search": "index=gen_ai_log source=pii_ml_scoring gen_ai.request.id=\"$row.Request_ID.value$\""
                    },
                    "type": "drilldown.linkToSearch"
                }
            ],
            "options": {
                "columnFormat": {
                    "Risk_Level": {
                        "data": "> table | seriesByName('Risk_Level') | formatByType(Risk_LevelColumnFormatEditorConfig)",
                        "rowBackgroundColors": "> table | seriesByName('Risk_Level') | matchValue(Risk_LevelRowBackgroundColorConfig)"
                    }
                },
                "count": 25,
                "drilldown": "row"
            },
            "title": "Recent PII Detections",
            "type": "splunk.table"
        },
        "viz_pii_ml_risk_distribution": {
            "dataSources": { "primary": "ds_pii_ml_risk_distribution" },
            "options": {
                "labelDisplay": "valuesAndPercentage",
                "seriesColorsByValue": {
                    "CRITICAL": "#9c1c1c",
                    "HIGH": "#dc4e41",
                    "MEDIUM": "#f8be34",
                    "NONE": "#53a051"
                },
                "showDonutHole": true
            },
            "title": "Risk Level Distribution",
            "type": "splunk.pie"
        },
        "viz_pii_ml_total": {
            "dataSources": { "primary": "ds_pii_ml_total" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "> majorValue | rangeValue(majorColorEditorConfig)",
                "majorColorEditorConfig": [
                    { "to": 1, "value": "#53a051" },
                    { "from": 1, "to": 10, "value": "#f8be34" },
                    { "from": 10, "value": "#dc4e41" }
                ],
                "sparklineDisplay": "off",
                "trendDisplay": "off"
            },
            "title": "PII Detections",
            "type": "splunk.singlevalue"
        },
        "viz_pii_ml_total_events": {
            "dataSources": { "primary": "ds_pii_ml_total_events" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "#53a051",
                "sparklineDisplay": "off",
                "trendDisplay": "off"
            },
            "title": "Total Events",
            "type": "splunk.singlevalue"
        },
        "viz_pii_ml_trend": {
            "dataSources": { "primary": "ds_pii_ml_trend" },
            "options": {
                "legendDisplay": "bottom",
                "seriesColors": ["#dc4e41", "#53a051"],
                "xAxisTitleText": "Time",
                "yAxisTitleText": "Count"
            },
            "title": "PII Detection Trend",
            "type": "splunk.line"
        },
        "viz_review_queue_link": {
            "context": {},
            "dataSources": { "primary": "ds_review_queue_link" },
            "eventHandlers": [
                {
                    "options": {
                        "app": "TA-gen_ai_cim",
                        "dashboard": "review_queue",
                        "newTab": true
                    },
                    "type": "drilldown.linkToDashboard"
                }
            ],
            "options": {
                "backgroundColor": "transparent",
                "majorFontSize": 18,
                "majorValue": "> primary | seriesByIndex(0) | lastPoint()",
                "sparklineDisplay": "off",
                "trendDisplay": "off",
                "unit": "",
                "unitPosition": "after"
            },
            "type": "splunk.singlevalue"
        }
    },
    "dataSources": {
        "ds_model_filter": {
            "options": {
                "query": "index=gen_ai_log source=pii_ml_scoring | stats count by gen_ai.request.model | fields gen_ai.request.model",
                "queryParameters": { "earliest": "-7d@d", "latest": "now" }
            },
            "type": "ds.search"
        },
        "ds_service_filter": {
            "options": {
                "query": "index=gen_ai_log source=pii_ml_scoring | stats count by gen_ai.app.name | fields gen_ai.app.name",
                "queryParameters": { "earliest": "-7d@d", "latest": "now" }
            },
            "type": "ds.search"
        },
        "ds_pii_ml_by_service": {
            "options": {
                "query": "index=gen_ai_log source=pii_ml_scoring (gen_ai.pii.ml_detected=\"true\" OR gen_ai.pii.ml_detected=\"false\") gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats sum(eval(if('gen_ai.pii.ml_detected'=\"true\", 1, 0))) as PII_Count, count as Total_Requests by gen_ai.app.name | eval PII_Rate=round(PII_Count/Total_Requests*100, 1).\"%\" | rename gen_ai.app.name as Service | sort -PII_Count",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_pii_ml_category": {
            "options": {
                "query": "index=gen_ai_log source=pii_ml_scoring gen_ai.pii.ml_detected=\"true\" gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | eval pii_types=split('gen_ai.pii.types', \",\") | mvexpand pii_types | eval pii_types=trim(pii_types) | stats count as Count by pii_types | rename pii_types as PII_Category | sort -Count",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_pii_ml_rate": {
            "options": {
                "query": "index=gen_ai_log source=pii_ml_scoring (gen_ai.pii.ml_detected=\"true\" OR gen_ai.pii.ml_detected=\"false\") gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats sum(eval(if('gen_ai.pii.ml_detected'=\"true\", 1, 0))) as pii_count, count as total | eval detection_rate=round(pii_count/total*100, 1) | fields detection_rate",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_pii_ml_recent": {
            "options": {
                "query": "index=gen_ai_log source=pii_ml_scoring gen_ai.pii.ml_detected=\"true\" gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | eval Risk_Level=case('gen_ai.pii.risk_score'>=0.8 OR match('gen_ai.pii.types', \"SSN|CREDIT_CARD\"), \"CRITICAL\", 'gen_ai.pii.risk_score'>=0.6, \"HIGH\", 'gen_ai.pii.risk_score'>=0.3, \"MEDIUM\", 1=1, \"LOW\"), Timestamp=strftime(_time, \"%Y-%m-%d %H:%M:%S\"), Request_ID='gen_ai.request.id', PII_Types='gen_ai.pii.types', Confidence='gen_ai.pii.confidence' | table Request_ID, Timestamp, gen_ai.app.name, gen_ai.request.model, Risk_Level, PII_Types, Confidence | rename gen_ai.app.name as Service, gen_ai.request.model as Model | sort -Timestamp | head 25",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_pii_ml_risk_distribution": {
            "options": {
                "query": "index=gen_ai_log source=pii_ml_scoring (gen_ai.pii.ml_detected=\"true\" OR gen_ai.pii.ml_detected=\"false\") gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | eval risk_level=case('gen_ai.pii.risk_score'>=0.8 OR match('gen_ai.pii.types', \"SSN|CREDIT_CARD\"), \"CRITICAL\", 'gen_ai.pii.risk_score'>=0.6, \"HIGH\", 'gen_ai.pii.risk_score'>=0.3, \"MEDIUM\", 1=1, \"NONE\") | stats count by risk_level | rename risk_level as Risk_Level",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_pii_ml_total": {
            "options": {
                "query": "index=gen_ai_log source=pii_ml_scoring gen_ai.pii.ml_detected=\"true\" gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats count as pii_total | eval pii_total=coalesce(pii_total, 0)",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_pii_ml_total_events": {
            "options": {
                "query": "index=gen_ai_log source=pii_ml_scoring (gen_ai.pii.ml_detected=\"true\" OR gen_ai.pii.ml_detected=\"false\") gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats count as total_events",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_pii_ml_trend": {
            "options": {
                "query": "index=gen_ai_log source=pii_ml_scoring (gen_ai.pii.ml_detected=\"true\" OR gen_ai.pii.ml_detected=\"false\") gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | timechart span=1h sum(eval(if('gen_ai.pii.ml_detected'=\"true\", 1, 0))) as PII_Detections, count as Total_Events",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_review_queue_link": {
            "options": {
                "query": "| makeresults | eval link_text=\"ðŸ“‹ Review Queue â†’\" | table link_text"
            },
            "type": "ds.search"
        }
    },
    "layout": {
        "globalInputs": ["input_time", "input_service", "input_model"],
        "options": { "showTitleAndDescription": true, "height": 1100, "width": 1440 },
        "type": "grid",
        "structure": [
            { "item": "viz_header_pii_ml", "position": { "h": 70, "w": 1440, "x": 0, "y": 0 }, "type": "block" },
            { "item": "viz_pii_ml_total", "position": { "h": 120, "w": 360, "x": 0, "y": 70 }, "type": "block" },
            { "item": "viz_pii_ml_total_events", "position": { "h": 120, "w": 360, "x": 360, "y": 70 }, "type": "block" },
            { "item": "viz_pii_ml_rate", "position": { "h": 120, "w": 360, "x": 720, "y": 70 }, "type": "block" },
            { "item": "viz_review_queue_link", "position": { "h": 120, "w": 360, "x": 1080, "y": 70 }, "type": "block" },
            { "item": "viz_pii_ml_trend", "position": { "h": 280, "w": 720, "x": 0, "y": 190 }, "type": "block" },
            { "item": "viz_pii_ml_category", "position": { "h": 280, "w": 720, "x": 720, "y": 190 }, "type": "block" },
            { "item": "viz_pii_ml_risk_distribution", "position": { "h": 280, "w": 720, "x": 0, "y": 470 }, "type": "block" },
            { "item": "viz_pii_ml_by_service", "position": { "h": 280, "w": 720, "x": 720, "y": 470 }, "type": "block" },
            { "item": "viz_pii_ml_recent", "position": { "h": 350, "w": 1440, "x": 0, "y": 750 }, "type": "block" }
        ]
    }
}
]]></definition>
</dashboard>
