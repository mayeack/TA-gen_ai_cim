
<dashboard version="2" theme="dark">
    <label>AI Governance Overview</label>
    <description>A centralized view of genAI usage, cost, performance, and riskâ€”tracking safety/PII/policy events, anomalous prompts/responses, token spend, and latency across models, services, and sessions.</description>
    <definition><![CDATA[
{
    "title": "AI Governance Overview",
    "description": "A centralized view of genAI usage, cost, performance, and riskâ€”tracking safety/PII/policy events, anomalous prompts/responses, token spend, and latency across models, services, and sessions.",
    "inputs": {
        "input_model": {
            "dataSources": {
                "primary": "ds_model_filter"
            },
            "options": {
                "defaultValue": "*",
                "items": [
                    {
                        "label": "All Models",
                        "value": "*"
                    }
                ],
                "token": "model_filter"
            },
            "title": "Model ID",
            "type": "input.dropdown"
        },
        "input_service": {
            "dataSources": {
                "primary": "ds_service_filter"
            },
            "options": {
                "defaultValue": "*",
                "items": [
                    {
                        "label": "All Services",
                        "value": "*"
                    }
                ],
                "token": "service_filter"
            },
            "title": "Service",
            "type": "input.dropdown"
        },
        "input_time": {
            "options": {
                "defaultValue": "-24h@h,now",
                "token": "time"
            },
            "title": "Time Range",
            "type": "input.timerange"
        }
    },
    "defaults": {
        "dataSources": {
            "ds.search": {
                "options": {
                    "queryParameters": {
                        "earliest": "-24h@h",
                        "latest": "now"
                    }
                }
            }
        }
    },
    "visualizations": {
        "viz_avg_latency": {
            "dataSources": {
                "primary": "ds_avg_latency"
            },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "> majorValue | rangeValue(majorColorEditorConfig)",
                "majorColorEditorConfig": [
                    { "to": 2000, "value": "#53a051" },
                    { "from": 2000, "to": 5000, "value": "#f8be34" },
                    { "from": 5000, "value": "#dc4e41" }
                ],
                "sparklineDisplay": "off",
                "trendDisplay": "off",
                "unit": "ms",
                "unitPosition": "after"
            },
            "title": "Avg Response Latency",
            "type": "splunk.singlevalue"
        },
        "viz_compliance_summary": {
            "context": {
                "PII_Free_PctColumnFormatEditorConfig": {},
                "PII_Free_PctRowBackgroundColorConfig": [
                    { "to": 90, "value": "#DC4E41" },
                    { "from": 90, "to": 98, "value": "#F8BE34" },
                    { "from": 98, "value": "#53A051" }
                ],
                "Safety_Compliance_PctColumnFormatEditorConfig": {},
                "Safety_Compliance_PctRowBackgroundColorConfig": [
                    { "to": 85, "value": "#DC4E41" },
                    { "from": 85, "to": 95, "value": "#F8BE34" },
                    { "from": 95, "value": "#53A051" }
                ]
            },
            "dataSources": {
                "primary": "ds_compliance_summary"
            },
            "options": {
                "columnFormat": {
                    "PII_Free_Pct": {
                        "data": "> table | seriesByName('PII_Free_Pct') | formatByType(PII_Free_PctColumnFormatEditorConfig)",
                        "rowBackgroundColors": "> table | seriesByName('PII_Free_Pct') | rangeValue(PII_Free_PctRowBackgroundColorConfig)"
                    },
                    "Safety_Compliance_Pct": {
                        "data": "> table | seriesByName('Safety_Compliance_Pct') | formatByType(Safety_Compliance_PctColumnFormatEditorConfig)",
                        "rowBackgroundColors": "> table | seriesByName('Safety_Compliance_Pct') | rangeValue(Safety_Compliance_PctRowBackgroundColorConfig)"
                    }
                }
            },
            "title": "Safety Compliance Summary",
            "type": "splunk.table"
        },
        "viz_cost_by_service": {
            "dataSources": { "primary": "ds_cost_by_service" },
            "options": { "labelDisplay": "valuesAndPercentage", "showDonutHole": true },
            "title": "Cost by Service",
            "type": "splunk.pie"
        },
        "viz_cost_time": {
            "dataSources": { "primary": "ds_cost_time" },
            "options": {
                "seriesColors": ["#f7bc38"],
                "xAxisTitleText": "Time",
                "yAxisTitleText": "Cost ($)"
            },
            "title": "Cost Over Time",
            "type": "splunk.area"
        },
        "viz_error_messages": {
            "dataSources": { "primary": "ds_error_messages" },
            "options": { "count": 10 },
            "title": "Error Messages",
            "type": "splunk.table"
        },
        "viz_guardrails_triggered": {
            "dataSources": { "primary": "ds_guardrails_triggered" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "> majorValue | rangeValue(majorColorEditorConfig)",
                "majorColorEditorConfig": [
                    { "to": 1, "value": "#53a051" },
                    { "from": 1, "to": 5, "value": "#f8be34" },
                    { "from": 5, "value": "#dc4e41" }
                ],
                "sparklineDisplay": "off",
                "trendDisplay": "off"
            },
            "title": "Guardrails Triggered",
            "type": "splunk.singlevalue"
        },
        "viz_header_compliance": {
            "options": { "fontColor": "#ffffff", "markdown": "## âœ… Compliance Summary" },
            "type": "splunk.markdown"
        },
        "viz_header_cost": {
            "options": { "fontColor": "#ffffff", "markdown": "## ðŸ’° Cost Analysis" },
            "type": "splunk.markdown"
        },
        "viz_header_kpi": {
            "options": { "fontColor": "#ffffff", "markdown": "## ðŸ“Š Key Performance Indicators" },
            "type": "splunk.markdown"
        },
        "viz_header_logs": {
            "options": { "fontColor": "#ffffff", "markdown": "## ðŸ“‹ Recent AI Requests" },
            "type": "splunk.markdown"
        },
        "viz_header_model": {
            "options": { "fontColor": "#ffffff", "markdown": "## ðŸ¤– Model Analysis" },
            "type": "splunk.markdown"
        },
        "viz_header_safety": {
            "options": { "fontColor": "#ffffff", "markdown": "## ðŸ›¡ï¸ Safety & Compliance Metrics" },
            "type": "splunk.markdown"
        },
        "viz_header_service": {
            "options": { "fontColor": "#ffffff", "markdown": "## ðŸ”§ Service Analysis" },
            "type": "splunk.markdown"
        },
        "viz_header_session": {
            "options": { "fontColor": "#ffffff", "markdown": "## ðŸ‘¤ Session Analysis" },
            "type": "splunk.markdown"
        },
        "viz_header_status": {
            "options": { "fontColor": "#ffffff", "markdown": "## âš ï¸ Status & Errors" },
            "type": "splunk.markdown"
        },
        "viz_header_trends": {
            "options": { "fontColor": "#ffffff", "markdown": "## ðŸ“ˆ Trend Analysis" },
            "type": "splunk.markdown"
        },
        "viz_latency_distribution": {
            "dataSources": { "primary": "ds_latency_distribution" },
            "options": {
                "seriesColors": ["#f7bc38"],
                "xAxisTitleText": "Latency Bucket",
                "yAxisTitleText": "Count"
            },
            "title": "Latency Distribution",
            "type": "splunk.column"
        },
        "viz_latency_time": {
            "dataSources": { "primary": "ds_latency_time" },
            "options": {
                "legendDisplay": "bottom",
                "seriesColors": ["#53a051", "#dc4e41"],
                "xAxisTitleText": "Time",
                "yAxisTitleText": "Latency (ms)"
            },
            "title": "Response Latency Over Time",
            "type": "splunk.line"
        },
        "viz_model_usage": {
            "dataSources": { "primary": "ds_model_usage" },
            "options": { "count": 10 },
            "title": "Model Usage Statistics",
            "type": "splunk.table"
        },
        "viz_pii_detected": {
            "dataSources": { "primary": "ds_pii_detected" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "> majorValue | rangeValue(majorColorEditorConfig)",
                "majorColorEditorConfig": [
                    { "to": 1, "value": "#53a051" },
                    { "from": 1, "to": 5, "value": "#f8be34" },
                    { "from": 5, "value": "#dc4e41" }
                ],
                "sparklineDisplay": "off",
                "trendDisplay": "off"
            },
            "title": "PII Detected",
            "type": "splunk.singlevalue"
        },
        "viz_policy_blocked": {
            "dataSources": { "primary": "ds_policy_blocked" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "> majorValue | rangeValue(majorColorEditorConfig)",
                "majorColorEditorConfig": [
                    { "to": 1, "value": "#53a051" },
                    { "from": 1, "to": 5, "value": "#f8be34" },
                    { "from": 5, "value": "#dc4e41" }
                ],
                "sparklineDisplay": "off",
                "trendDisplay": "off"
            },
            "title": "Policy Blocked",
            "type": "splunk.singlevalue"
        },
        "viz_recent_requests": {
            "context": {
                "PII_DetectedColumnFormatEditorConfig": {},
                "PII_DetectedRowBackgroundColorConfig": [
                    { "match": "false", "value": "#53A051" },
                    { "match": "true", "value": "#DC4E41" }
                ],
                "Policy_BlockedColumnFormatEditorConfig": {},
                "Policy_BlockedRowBackgroundColorConfig": [
                    { "match": "false", "value": "#53A051" },
                    { "match": "true", "value": "#DC4E41" }
                ],
                "Safety_ViolatedColumnFormatEditorConfig": {},
                "Safety_ViolatedRowBackgroundColorConfig": [
                    { "match": "false", "value": "#53A051" },
                    { "match": "true", "value": "#DC4E41" }
                ]
            },
            "dataSources": { "primary": "ds_recent_requests" },
            "options": {
                "columnFormat": {
                    "PII_Detected": {
                        "data": "> table | seriesByName('PII_Detected') | formatByType(PII_DetectedColumnFormatEditorConfig)",
                        "rowBackgroundColors": "> table | seriesByName('PII_Detected') | matchValue(PII_DetectedRowBackgroundColorConfig)"
                    },
                    "Policy_Blocked": {
                        "data": "> table | seriesByName('Policy_Blocked') | formatByType(Policy_BlockedColumnFormatEditorConfig)",
                        "rowBackgroundColors": "> table | seriesByName('Policy_Blocked') | matchValue(Policy_BlockedRowBackgroundColorConfig)"
                    },
                    "Safety_Violated": {
                        "data": "> table | seriesByName('Safety_Violated') | formatByType(Safety_ViolatedColumnFormatEditorConfig)",
                        "rowBackgroundColors": "> table | seriesByName('Safety_Violated') | matchValue(Safety_ViolatedRowBackgroundColorConfig)"
                    }
                },
                "count": 20
            },
            "title": "Recent AI Requests (Detailed Log)",
            "type": "splunk.table"
        },
        "viz_request_volume": {
            "dataSources": { "primary": "ds_request_volume" },
            "options": {
                "legendDisplay": "bottom",
                "seriesColors": ["#5cc05c"],
                "xAxisTitleText": "Time",
                "yAxisTitleText": "Requests"
            },
            "title": "AI Request Volume Over Time",
            "type": "splunk.area"
        },
        "viz_requests_by_service": {
            "dataSources": { "primary": "ds_requests_by_service" },
            "options": {
                "seriesColors": ["#5cc05c"],
                "xAxisTitleText": "Requests",
                "yAxisTitleText": "Service"
            },
            "title": "Requests by Service",
            "type": "splunk.bar"
        },
        "viz_retries": {
            "dataSources": { "primary": "ds_retries" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "#5cc05c",
                "sparklineDisplay": "off",
                "trendDisplay": "off"
            },
            "title": "Retries",
            "type": "splunk.singlevalue"
        },
        "viz_safety_violations": {
            "dataSources": { "primary": "ds_safety_violations" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "> majorValue | rangeValue(majorColorEditorConfig)",
                "majorColorEditorConfig": [
                    { "to": 1, "value": "#53a051" },
                    { "from": 1, "to": 5, "value": "#f8be34" },
                    { "from": 5, "value": "#dc4e41" }
                ],
                "sparklineDisplay": "off",
                "trendDisplay": "off"
            },
            "title": "Safety Violations",
            "type": "splunk.singlevalue"
        },
        "viz_service_performance": {
            "dataSources": { "primary": "ds_service_performance" },
            "options": { "count": 10 },
            "title": "Service Performance Comparison",
            "type": "splunk.table"
        },
        "viz_session_activity": {
            "dataSources": { "primary": "ds_session_activity" },
            "options": { "count": 10 },
            "title": "Session Activity",
            "type": "splunk.table"
        },
        "viz_status_distribution": {
            "dataSources": { "primary": "ds_status_distribution" },
            "options": { "labelDisplay": "valuesAndPercentage", "showDonutHole": true },
            "title": "HTTP Status Distribution",
            "type": "splunk.pie"
        },
        "viz_token_usage_time": {
            "dataSources": { "primary": "ds_token_usage_time" },
            "options": {
                "legendDisplay": "bottom",
                "seriesColors": ["#6ab7c7"],
                "xAxisTitleText": "Time",
                "yAxisTitleText": "Total Tokens"
            },
            "title": "Token Usage Over Time",
            "type": "splunk.area"
        },
        "viz_total_cost": {
            "dataSources": { "primary": "ds_total_cost" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "#f7bc38",
                "numberPrecision": 4,
                "sparklineDisplay": "off",
                "trendDisplay": "off",
                "unit": "$",
                "unitPosition": "before"
            },
            "title": "Total Cost",
            "type": "splunk.singlevalue"
        },
        "viz_total_requests": {
            "dataSources": { "primary": "ds_total_requests" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "#53a051",
                "sparklineDisplay": "off",
                "trendDisplay": "off",
                "unit": ""
            },
            "title": "Total AI Requests",
            "type": "splunk.singlevalue"
        },
        "viz_total_tokens": {
            "dataSources": { "primary": "ds_total_tokens" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "#6ab7c7",
                "sparklineDisplay": "off",
                "trendDisplay": "off"
            },
            "title": "Total Token Usage",
            "type": "splunk.singlevalue"
        },
        "viz_unique_sessions": {
            "dataSources": { "primary": "ds_unique_sessions" },
            "options": {
                "backgroundColor": "transparent",
                "majorColor": "#5cc05c",
                "sparklineDisplay": "off",
                "trendDisplay": "off"
            },
            "title": "Unique Sessions",
            "type": "splunk.singlevalue"
        }
    },
    "dataSources": {
        "ds_avg_latency": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" gen_ai.client.operation.duration=* | stats avg(gen_ai.client.operation.duration) as avg_latency | eval avg_latency=round(avg_latency*1000, 0) | eval avg_latency=coalesce(avg_latency, 0)",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_compliance_summary": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats count as Total_Requests, sum(eval(if('gen_ai.safety.violated'=\"true\", 1, 0))) as Safety_Violations, sum(eval(if('gen_ai.pii.detected'=\"true\", 1, 0))) as PII_Detections, sum(eval(if('gen_ai.policy.blocked'=\"true\", 1, 0))) as Policy_Blocks | eval Safety_Violations=coalesce(Safety_Violations, 0) | eval PII_Detections=coalesce(PII_Detections, 0) | eval Policy_Blocks=coalesce(Policy_Blocks, 0) | eval PII_Free_Pct=round(((Total_Requests-PII_Detections)/Total_Requests)*100, 2) | eval Safety_Compliance_Pct=round(((Total_Requests-Safety_Violations)/Total_Requests)*100, 2)",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_cost_by_service": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | eval _input_dir=\"input\", _output_dir=\"output\" | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _input_dir OUTPUT cost_per_million AS _input_cpm | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _output_dir OUTPUT cost_per_million AS _output_cpm | eval cost = (coalesce('gen_ai.usage.input_tokens', 0) * coalesce(_input_cpm, 0) / 1000000) + (coalesce('gen_ai.usage.output_tokens', 0) * coalesce(_output_cpm, 0) / 1000000) | stats sum(cost) as total_cost by gen_ai.app.name | sort -total_cost",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_cost_time": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | eval _input_dir=\"input\", _output_dir=\"output\" | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _input_dir OUTPUT cost_per_million AS _input_cpm | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _output_dir OUTPUT cost_per_million AS _output_cpm | eval cost = (coalesce('gen_ai.usage.input_tokens', 0) * coalesce(_input_cpm, 0) / 1000000) + (coalesce('gen_ai.usage.output_tokens', 0) * coalesce(_output_cpm, 0) / 1000000) | timechart span=1h sum(cost) as total_cost",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_error_messages": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" ('gen_ai.safety.violated'=\"true\" OR 'gen_ai.policy.blocked'=\"true\" OR 'gen_ai.pii.detected'=\"true\") | eval error_type=case('gen_ai.safety.violated'=\"true\", \"Safety Violation\", 'gen_ai.policy.blocked'=\"true\", \"Policy Blocked\", 'gen_ai.pii.detected'=\"true\", \"PII Detected\", 1=1, \"Unknown\") | stats count as Error_Count, latest(_time) as Last_Occurrence, values(gen_ai.app.name) as Services by error_type | eval Last_Occurrence=strftime(Last_Occurrence, \"%Y-%m-%d %H:%M:%S\") | rename error_type as Error_Type | sort -Error_Count | head 10",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_guardrails_triggered": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats sum(eval(if('gen_ai.guardrail.triggered'=\"true\", 1, 0))) as guardrails_triggered | eval guardrails_triggered=coalesce(guardrails_triggered, 0)",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_latency_distribution": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" gen_ai.client.operation.duration=* | eval latency_bucket=case('gen_ai.client.operation.duration'<1, \"<1s\", 'gen_ai.client.operation.duration'<2, \"1-2s\", 'gen_ai.client.operation.duration'<5, \"2-5s\", 'gen_ai.client.operation.duration'<10, \"5-10s\", 'gen_ai.client.operation.duration'<30, \"10-30s\", 1=1, \">30s\") | stats count by latency_bucket | sort latency_bucket",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_latency_time": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" gen_ai.client.operation.duration=* | eval latency_ms='gen_ai.client.operation.duration'*1000 | timechart span=1h avg(latency_ms) as avg_latency_ms, perc95(latency_ms) as p95_latency_ms",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_model_filter": {
            "options": {
                "query": "index=gen_ai_log | stats count by gen_ai.request.model | fields gen_ai.request.model",
                "queryParameters": { "earliest": "-7d@d", "latest": "now" }
            },
            "type": "ds.search"
        },
        "ds_model_usage": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | eval _input_dir=\"input\", _output_dir=\"output\" | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _input_dir OUTPUT cost_per_million AS _input_cpm | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _output_dir OUTPUT cost_per_million AS _output_cpm | eval event_cost = (coalesce('gen_ai.usage.input_tokens', 0) * coalesce(_input_cpm, 0) / 1000000) + (coalesce('gen_ai.usage.output_tokens', 0) * coalesce(_output_cpm, 0) / 1000000) | stats count as Requests, values(gen_ai.provider.name) as Provider, avg(gen_ai.request.temperature) as Avg_Temperature, avg(gen_ai.client.operation.duration) as Avg_Latency_sec, sum(gen_ai.usage.total_tokens) as Total_Tokens, sum(event_cost) as Total_Cost_USD by gen_ai.request.model | eval Avg_Temperature=round(Avg_Temperature, 2) | eval Avg_Latency_ms=round(Avg_Latency_sec*1000, 0) | eval Total_Cost_USD=round(coalesce(Total_Cost_USD, 0), 4) | rename gen_ai.request.model as Model_ID | fields Model_ID, Requests, Provider, Avg_Temperature, Avg_Latency_ms, Total_Cost_USD, Total_Tokens | sort -Requests",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_pii_detected": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats sum(eval(if('gen_ai.pii.detected'=\"true\", 1, 0))) as pii_detected | eval pii_detected=coalesce(pii_detected, 0)",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_policy_blocked": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats sum(eval(if('gen_ai.policy.blocked'=\"true\", 1, 0))) as policy_blocked | eval policy_blocked=coalesce(policy_blocked, 0)",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_recent_requests": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | eval _input_dir=\"input\", _output_dir=\"output\" | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _input_dir OUTPUT cost_per_million AS _input_cpm | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _output_dir OUTPUT cost_per_million AS _output_cpm | eval Timestamp=strftime(_time, \"%Y-%m-%d %H:%M:%S\") | eval Latency_ms=round('gen_ai.client.operation.duration'*1000, 0) | eval Tokens=coalesce('gen_ai.usage.total_tokens', 0) | eval Cost_USD=round((coalesce('gen_ai.usage.input_tokens', 0) * coalesce(_input_cpm, 0) / 1000000) + (coalesce('gen_ai.usage.output_tokens', 0) * coalesce(_output_cpm, 0) / 1000000), 6) | table Timestamp, gen_ai.request.id, gen_ai.session.id, gen_ai.app.name, gen_ai.request.model, Latency_ms, Tokens, Cost_USD, gen_ai.safety.violated, gen_ai.pii.detected, gen_ai.policy.blocked | rename gen_ai.request.id as Request_ID, gen_ai.session.id as Session_ID, gen_ai.app.name as Service, gen_ai.request.model as Model, gen_ai.safety.violated as Safety_Violated, gen_ai.pii.detected as PII_Detected, gen_ai.policy.blocked as Policy_Blocked | sort -Timestamp | head 20",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_request_volume": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | timechart span=1h count as requests",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_requests_by_service": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats count as requests by gen_ai.app.name | sort -requests",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_retries": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats sum(eval(coalesce('gen_ai.retry.count', 0))) as total_retries | eval total_retries=coalesce(total_retries, 0)",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_safety_violations": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats sum(eval(if('gen_ai.safety.violated'=\"true\", 1, 0))) as safety_violations | eval safety_violations=coalesce(safety_violations, 0)",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_service_filter": {
            "options": {
                "query": "index=gen_ai_log | stats count by gen_ai.app.name | fields gen_ai.app.name",
                "queryParameters": { "earliest": "-7d@d", "latest": "now" }
            },
            "type": "ds.search"
        },
        "ds_service_performance": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | eval _input_dir=\"input\", _output_dir=\"output\" | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _input_dir OUTPUT cost_per_million AS _input_cpm | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _output_dir OUTPUT cost_per_million AS _output_cpm | eval event_cost = (coalesce('gen_ai.usage.input_tokens', 0) * coalesce(_input_cpm, 0) / 1000000) + (coalesce('gen_ai.usage.output_tokens', 0) * coalesce(_output_cpm, 0) / 1000000) | stats count as Requests, avg(gen_ai.client.operation.duration) as Avg_Latency_sec, sum(gen_ai.usage.total_tokens) as Total_Tokens, sum(event_cost) as Total_Cost_USD by gen_ai.app.name | eval Avg_Latency_ms=round(Avg_Latency_sec*1000, 0) | eval Total_Cost_USD=round(coalesce(Total_Cost_USD, 0), 4) | rename gen_ai.app.name as Service | fields Service, Requests, Avg_Latency_ms, Total_Cost_USD, Total_Tokens | sort -Requests",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_session_activity": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | eval _input_dir=\"input\", _output_dir=\"output\" | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _input_dir OUTPUT cost_per_million AS _input_cpm | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _output_dir OUTPUT cost_per_million AS _output_cpm | eval event_cost = (coalesce('gen_ai.usage.input_tokens', 0) * coalesce(_input_cpm, 0) / 1000000) + (coalesce('gen_ai.usage.output_tokens', 0) * coalesce(_output_cpm, 0) / 1000000) | stats count as Interactions, min(_time) as Session_Start, max(_time) as Session_End, sum(gen_ai.usage.total_tokens) as Session_Tokens, sum(event_cost) as Session_Cost_USD, avg(gen_ai.client.operation.duration) as Avg_Latency_sec by gen_ai.session.id | eval Session_Start=strftime(Session_Start, \"%Y-%m-%d %H:%M:%S\") | eval Session_End=strftime(Session_End, \"%Y-%m-%d %H:%M:%S\") | eval Session_Cost_USD=round(coalesce(Session_Cost_USD, 0), 4) | eval Avg_Latency_ms=round(Avg_Latency_sec*1000, 0) | rename gen_ai.session.id as Session_ID | fields Session_ID, Interactions, Session_Start, Session_End, Session_Cost_USD, Session_Tokens, Avg_Latency_ms | sort -Interactions | head 10",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_status_distribution": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | eval status=case('gen_ai.safety.violated'=\"true\", \"Safety Violation\", 'gen_ai.policy.blocked'=\"true\", \"Policy Blocked\", 'gen_ai.pii.detected'=\"true\", \"PII Detected\", 1=1, \"Success\") | stats count by status | sort -count",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_token_usage_time": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | timechart span=1h sum(gen_ai.usage.total_tokens) as total_tokens",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_total_cost": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | eval _input_dir=\"input\", _output_dir=\"output\" | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _input_dir OUTPUT cost_per_million AS _input_cpm | lookup genai_token_cost_lookup provider AS gen_ai.provider.name, model AS gen_ai.request.model, direction AS _output_dir OUTPUT cost_per_million AS _output_cpm | eval event_cost = (coalesce('gen_ai.usage.input_tokens', 0) * coalesce(_input_cpm, 0) / 1000000) + (coalesce('gen_ai.usage.output_tokens', 0) * coalesce(_output_cpm, 0) / 1000000) | stats sum(event_cost) as total_cost | eval total_cost=round(coalesce(total_cost, 0), 4)",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_total_requests": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats count as total_requests",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_total_tokens": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats sum(gen_ai.usage.total_tokens) as total_tokens | eval total_tokens=if(isnull(total_tokens) OR total_tokens=\"\", 0, total_tokens)",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        },
        "ds_unique_sessions": {
            "options": {
                "query": "index=gen_ai_log gen_ai.app.name=\"$service_filter$\" gen_ai.request.model=\"$model_filter$\" | stats dc(gen_ai.session.id) as unique_sessions",
                "queryParameters": { "earliest": "$time.earliest$", "latest": "$time.latest$" }
            },
            "type": "ds.search"
        }
    },
    "layout": {
        "globalInputs": ["input_time", "input_service", "input_model"],
        "options": { "showTitleAndDescription": true, "height": 3200, "width": 1440 },
        "type": "grid",
        "structure": [
            { "item": "viz_header_kpi", "position": { "h": 50, "w": 1440, "x": 0, "y": 0 }, "type": "block" },
            { "item": "viz_total_requests", "position": { "h": 120, "w": 288, "x": 0, "y": 50 }, "type": "block" },
            { "item": "viz_unique_sessions", "position": { "h": 120, "w": 288, "x": 288, "y": 50 }, "type": "block" },
            { "item": "viz_total_tokens", "position": { "h": 120, "w": 288, "x": 576, "y": 50 }, "type": "block" },
            { "item": "viz_total_cost", "position": { "h": 120, "w": 288, "x": 864, "y": 50 }, "type": "block" },
            { "item": "viz_avg_latency", "position": { "h": 120, "w": 288, "x": 1152, "y": 50 }, "type": "block" },
            { "item": "viz_header_safety", "position": { "h": 50, "w": 1440, "x": 0, "y": 170 }, "type": "block" },
            { "item": "viz_safety_violations", "position": { "h": 120, "w": 288, "x": 0, "y": 220 }, "type": "block" },
            { "item": "viz_pii_detected", "position": { "h": 120, "w": 288, "x": 288, "y": 220 }, "type": "block" },
            { "item": "viz_policy_blocked", "position": { "h": 120, "w": 288, "x": 576, "y": 220 }, "type": "block" },
            { "item": "viz_guardrails_triggered", "position": { "h": 120, "w": 288, "x": 864, "y": 220 }, "type": "block" },
            { "item": "viz_retries", "position": { "h": 120, "w": 288, "x": 1152, "y": 220 }, "type": "block" },
            { "item": "viz_header_trends", "position": { "h": 50, "w": 1440, "x": 0, "y": 340 }, "type": "block" },
            { "item": "viz_request_volume", "position": { "h": 280, "w": 720, "x": 0, "y": 390 }, "type": "block" },
            { "item": "viz_token_usage_time", "position": { "h": 280, "w": 720, "x": 720, "y": 390 }, "type": "block" },
            { "item": "viz_latency_distribution", "position": { "h": 280, "w": 720, "x": 0, "y": 670 }, "type": "block" },
            { "item": "viz_latency_time", "position": { "h": 280, "w": 720, "x": 720, "y": 670 }, "type": "block" },
            { "item": "viz_header_cost", "position": { "h": 50, "w": 1440, "x": 0, "y": 950 }, "type": "block" },
            { "item": "viz_cost_time", "position": { "h": 280, "w": 720, "x": 0, "y": 1000 }, "type": "block" },
            { "item": "viz_cost_by_service", "position": { "h": 280, "w": 720, "x": 720, "y": 1000 }, "type": "block" },
            { "item": "viz_header_service", "position": { "h": 50, "w": 1440, "x": 0, "y": 1280 }, "type": "block" },
            { "item": "viz_requests_by_service", "position": { "h": 280, "w": 720, "x": 0, "y": 1330 }, "type": "block" },
            { "item": "viz_service_performance", "position": { "h": 280, "w": 720, "x": 720, "y": 1330 }, "type": "block" },
            { "item": "viz_header_model", "position": { "h": 50, "w": 1440, "x": 0, "y": 1610 }, "type": "block" },
            { "item": "viz_model_usage", "position": { "h": 280, "w": 1440, "x": 0, "y": 1660 }, "type": "block" },
            { "item": "viz_header_session", "position": { "h": 50, "w": 1440, "x": 0, "y": 1940 }, "type": "block" },
            { "item": "viz_session_activity", "position": { "h": 280, "w": 1440, "x": 0, "y": 1990 }, "type": "block" },
            { "item": "viz_header_status", "position": { "h": 50, "w": 1440, "x": 0, "y": 2270 }, "type": "block" },
            { "item": "viz_status_distribution", "position": { "h": 280, "w": 720, "x": 0, "y": 2320 }, "type": "block" },
            { "item": "viz_error_messages", "position": { "h": 280, "w": 720, "x": 720, "y": 2320 }, "type": "block" },
            { "item": "viz_header_logs", "position": { "h": 50, "w": 1440, "x": 0, "y": 2600 }, "type": "block" },
            { "item": "viz_recent_requests", "position": { "h": 300, "w": 1440, "x": 0, "y": 2650 }, "type": "block" },
            { "item": "viz_header_compliance", "position": { "h": 50, "w": 1440, "x": 0, "y": 2950 }, "type": "block" },
            { "item": "viz_compliance_summary", "position": { "h": 180, "w": 1440, "x": 0, "y": 3000 }, "type": "block" }
        ]
    }
}
]]></definition>
</dashboard>
